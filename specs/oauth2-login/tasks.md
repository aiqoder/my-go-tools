# OAuth2 登录模块任务清单

## 任务列表

### 阶段 1: 类型定义

- [x] **T1.1** 创建 `oauth2/types.go` - 定义 TokenResponse、UserInfo、OAuth2Error 类型
  - 验收标准：类型定义完整，包含所有必需字段，JSON 标签正确

- [x] **T1.2** 创建 `oauth2/options.go` - 创建函数选项模式（可选，增强可配置性）
  - 验收标准：提供合理的默认选项，支持自定义配置

### 阶段 2: 服务层

- [x] **T2.1** 创建 `oauth2/service.go` - OAuth2Service 结构体和构造函数
  - 验收标准：结构体字段完整，构造函数正确初始化

- [x] **T2.2** 实现 `ExchangeCodeForToken` - 授权码换令牌
  - 验收标准：使用 POST 表单请求，正确处理 OAuth2 服务器响应

- [x] **T2.3** 实现 `GetUserInfo` - 获取用户信息
  - 验收标准：使用 Bearer Token 认证，正确解析用户信息

- [x] **T2.4** 实现 `RefreshToken` - 刷新令牌
  - 验收标准：使用 refresh_token grant 类型，正确返回新令牌

- [x] **T2.5** 实现 `GetConfig` - 获取公开配置
  - 验收标准：返回不含 client_secret 的配置

### 阶段 3: 处理器层

- [x] **T3.1** 创建 `oauth2/handler.go` - OAuth2Handler 结构体和构造函数
  - 验收标准：依赖服务层，构造函数正确注入

- [x] **T3.2** 实现 `GetConfig` 处理函数
  - 验收标准：GET /api/oauth2/config 返回 JSON 配置

- [x] **T3.3** 实现 `Callback` 处理函数
  - 验收标准：POST /api/oauth2/callback 正确处理授权码

- [x] **T3.4** 实现 `GetUserInfo` 处理函数
  - 验收标准：GET /api/oauth2/userinfo 从 Header 提取 Bearer Token

- [x] **T3.5** 实现 `RefreshToken` 处理函数
  - 验收标准：POST /api/oauth2/refresh 正确处理刷新请求

### 阶段 4: 路由配置

- [x] **T4.1** 创建 `oauth2/router.go` - 路由注册函数
  - 验收标准：注册所有 OAuth2 路由到 Gin 引擎

### 阶段 5: 测试

- [x] **T5.1** 创建 `oauth2/oauth2_test.go` - 单元测试
  - 验收标准：覆盖核心业务逻辑，使用 mock 模拟 HTTP 请求
  - 实现备注：19 个单元测试，全部通过

- [x] **T5.2** 创建 `oauth2/oauth2_bench_test.go` - 基准测试
  - 验收标准：关键路径有基准测试
  - 实现备注：7 个基准测试，包含性能数据

### 阶段 6: 示例和文档

- [x] **T6.1** 创建 `oauth2/examples_test.go` - 使用示例
  - 验收标准：包含完整的初始化和使用示例
  - 实现备注：6 个示例测试，全部通过

- [x] **T6.2** 创建 `oauth2/README.md` - 模块文档
  - 验收标准：包含安装、快速开始、API 文档

## 依赖关系

```
T1.1 ──┬──> T2.1 ──> T2.2 ──> T2.3 ──> T2.4 ──> T2.5
       │                                    │
       └──> T3.1 ──> T3.2 ──> T3.3 ──> T3.4 ──> T3.5 ──> T4.1
                                                      │
T1.2 ────────────────────────────────────────────────┘
                                                      │
T5.1 <───────────────────────────────────────────────┘
                                                      │
T5.2 <───────────────────────────────────────────────┘
                                                      │
T6.1 <───────────────────────────────────────────────┘
                                                      │
T6.2 <───────────────────────────────────────────────┘
```

## 执行顺序

1. 先完成阶段 1（类型定义）
2. 再完成阶段 2（服务层）
3. 然后阶段 3（处理器层）
4. 接着阶段 4（路由配置）
5. 阶段 5 和 6 可并行执行
