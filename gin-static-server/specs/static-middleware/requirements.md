# 静态文件中间件需求规格 (Requirements.md)

## 1. 需求概述

将现有的 `/*path` 通配符路由方式改为 Gin 中间件形式，解决与 API 路由冲突的问题。中间件仅在请求路径以特定前端资源结尾（如 `.js`、`.css`、`.html`）且文件存在于指定目录时，才处理并返回静态文件。

## 2. 功能需求 (EARS)

### 2.1 中间件核心行为

**前缀**: "The StaticFileMiddleware is a Gin middleware that..."

| 需求编号 | 描述 | 验收条件 |
|---------|------|----------|
| REQ-001 | 中间件必须检测请求路径是否以配置的前缀资源文件扩展名结尾 | 路径以 `.js`、`.css`、`.html`、`.json`、`.map`、`.woff`、`.woff2`、`.ttf`、`.svg`、`.png`、`.jpg`、`.gif`、`.ico`、`.webp` 结尾时触发处理 |
| REQ-002 | 中间件必须在指定的根目录中查找对应的物理文件 | 当请求 `/static/app.js` 时，查找 `./public/static/app.js` 或配置的根目录 |
| REQ-003 | 当文件存在时，中间件必须返回该静态文件 | 返回 200 状态码和正确的 Content-Type、文件内容 |
| REQ-004 | 当文件不存在时，中间件必须调用 `c.Next()` 继续传递请求 | 不拦截请求，让其他路由（如 API）处理 |
| REQ-005 | 中间件必须支持文件系统（osFS）和嵌入文件系统（embed.FS）两种模式 | 支持通过配置切换文件系统来源 |

### 2.2 配置选项

| 需求编号 | 描述 | 验收条件 |
|---------|------|----------|
| REQ-006 | 中间件必须支持配置静态文件根目录 | 提供 `Root` 配置项 |
| REQ-007 | 中间件必须支持配置 URL 路径前缀 | 提供 `Prefix` 配置项（如 `/static`） |
| REQ-008 | 中间件必须支持自定义静态资源扩展名列表 | 提供可配置的扩展名列表，默认包含常见前端资源 |
| REQ-009 | 中间件必须支持 embed.FS 嵌入文件系统 | 提供 `EmbedFS` 和 `EmbedRoot` 配置项 |

### 2.3 安全与性能

| 需求编号 | 描述 | 验收条件 |
|---------|------|----------|
| REQ-010 | 中间件必须防止目录遍历攻击 | 检测并拒绝包含 `../` 的路径请求 |
| REQ-011 | 中间件必须可选地支持 Gzip 压缩 | 提供 `EnableGzip` 配置项 |
| REQ-012 | 中间件必须可选地支持 ETag 缓存 | 提供 `UseETag` 配置项 |
| REQ-013 | 中间件必须可选地支持内存缓存 | 提供 `EnableCache` 配置项 |

## 3. 用户故事

### 用户故事 1：解决路由冲突

**作为** Go 后端开发者  
**我希望** 将静态文件服务改为中间件形式  
**以便** 避免与 API 路由冲突，不再需要使用 `/*path` 通配符捕获所有请求  

**验收标准**:
- [ ] 中间件可以在 Gin 引擎上通过 `Use()` 方法注册
- [ ] 中间件只处理以特定扩展名结尾的请求路径
- [ ] 其他路由（如 API）不受中间件影响，正常工作

### 用户故事 2：静态文件服务

**作为** 前端开发者  
**我希望** 访问 `.js`、`.css` 等静态资源时能正确返回文件  
**以便** 配合后端 API 使用  

**验收标准**:
- [ ] 请求 `/static/app.js` 时返回 `./public/static/app.js` 文件
- [ ] 响应头包含正确的 `Content-Type`
- [ ] 支持条件请求（If-None-Match、If-Modified-Since）

## 4. 非功能需求

- **性能**: 中间件处理应在毫秒级完成，不显著增加请求延迟
- **兼容性**: 保持与现有 `StaticEngine` 相同的功能特性（Gzip、缓存、ETag 等）
- **API 兼容性**: 新增中间件不破坏现有 `StaticEngine` 的使用方式

## 5. 依赖项

- `github.com/gin-gonic/gin` - Gin 框架
- 无新增外部依赖
